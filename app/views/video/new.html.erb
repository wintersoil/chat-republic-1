<div>
  I am on video page now!
  <%= link_to "Destroy connection", video_path(id: @client.id), method: :delete %>
</div>
<video autoplay></video>
<img id="returned-photo" src="">

<script>
const video = document.querySelector('video');
navigator.mediaDevices.getUserMedia({video: {width: 426, height: 240}}).then((stream) => video.srcObject = stream);

const getFrame = () => {
  const canvas = document.createElement('canvas');
  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;
  canvas.getContext('2d').drawImage(video, 0, 0);
  const data = canvas.toDataURL('image/png');
  return data;
}
</script>
<script>
const img = document.getElementById("returned-photo");
const WS_URL2 = 'wss://www.downlink.online/cable';
const ws = new WebSocket(WS_URL2);


const FPS = 3;
id = { channel: '<%= current_user %>' }
ws.onopen = () => {
  console.log('Connected to ${WS_URL}');
  setInterval(() => {
    ws.send(JSON.stringify({command: 'message', identifier: id, data: {action:'handle_messages',id:'<%= current_user.id %>',client: '<%= @client.id %>',image:getFrame()}}));
  }, 1000 / FPS);
}

</script>
